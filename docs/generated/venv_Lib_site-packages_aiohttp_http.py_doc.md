# aiohttp.http – Public HTTP API Facade

*File:* `venv\Lib\site-packages\aiohttp\http.py`

---

## 1. Module Purpose

| What it does | Why it exists |
|--------------|---------------|
| **Collects and re‑exports** the core HTTP‑related classes, parsers, constants and utility functions that make up aiohttp’s low‑level HTTP implementation. It also provides two convenience constants (`SERVER_SOFTWARE` and `RESPONSES`). | By offering a single import location (`aiohttp.http`) developers can reach the most frequently used HTTP building blocks without needing to know the exact sub‑module where each class lives. This reduces import boilerplate, improves discoverability, and decouples user code from internal package layout changes. |

The module is essentially a *facade* that gathers symbols from internal sub‑modules (`http_parser`, `http_writer`, `http_websocket`, …) and presents them as the public API surface for the low‑level HTTP layer of **aiohttp**.

---

## 2. Key Components

### 2.1 `__all__`

```python
__all__ = (
    "HttpProcessingError",
    "RESPONSES",
    "SERVER_SOFTWARE",
    # .http_writer
    "StreamWriter",
    "HttpVersion",
    "HttpVersion10",
    "HttpVersion11",
    # .http_parser
    "HeadersParser",
    "HttpParser",
    "HttpRequestParser",
    "HttpResponseParser",
    "RawRequestMessage",
    "RawResponseMessage",
    # .http_websocket
    "WS_CLOSED_MESSAGE",
    "WS_CLOSING_MESSAGE",
    "WS_KEY",
    "WebSocketReader",
    "WebSocketWriter",
    "ws_ext_gen",
    "ws_ext_parse",
    "WSMessage",
    "WebSocketError",
    "WSMsgType",
    "WSCloseCode",
)
```

* **Purpose** – Controls what `from aiohttp.http import *` exports. It also serves as a concise checklist for the public symbols that the module deliberately re‑exports.
* **Visibility** – All entries are *public*; anything not listed is considered internal to the sub‑modules.

---

### 2.2 `SERVER_SOFTWARE`

```python
SERVER_SOFTWARE: str = "Python/{0[0]}.{0[1]} aiohttp/{1}".format(
    sys.version_info, __version__
)
```

* **What it is** – A string that identifies the Python interpreter version and the aiohttp version. It is used by aiohttp’s default HTTP server to populate the `Server:` response header.
* **Inputs** – `sys.version_info` (tuple of ints) and `aiohttp.__version__` (string).  
* **Outputs** – Formatted string, e.g. `"Python/3.11 aiohttp/3.9.5"`.
* **Public API** – Exported via `__all__`, thus callers may reference `aiohttp.http.SERVER_SOFTWARE` when constructing custom responses.

---

### 2.3 `RESPONSES`

```python
RESPONSES: Mapping[int, Tuple[str, str]] = {
    v: (v.phrase, v.description) for v in HTTPStatus.__members__.values()
}
```

* **What it is** – A mapping from HTTP status code (int) → `(reason_phrase, description)` tuple.
* **Inputs** – The `http.HTTPStatus` enumeration from the Python stdlib.
* **Outputs** – Dictionary with entries such as `200: ("OK", "Request fulfilled, document follows")`.
* **Public API** – Exposed so that user code can look up human‑readable status information without importing `http.HTTPStatus` directly.

---

### 2.4 Re‑exported symbols (no implementation here)

| Symbol | Origin module | Brief role |
|--------|---------------|------------|
| `HttpProcessingError` | `.http_exceptions` | Base class for HTTP protocol errors raised during parsing/processing. |
| **Writer** | `.http_writer` | |
| `StreamWriter` | `.http_writer` | Low‑level stream writer that knows how to serialize HTTP messages. |
| `HttpVersion`, `HttpVersion10`, `HttpVersion11` | `.http_writer` | Enumerations / objects representing supported HTTP versions. |
| **Parser** | `.http_parser` | |
| `HeadersParser` | `.http_parser` | Parses raw header blocks into a mapping. |
| `HttpParser` | `.http_parser` | Core incremental HTTP parser used by request/response parsers. |
| `HttpRequestParser` | `.http_parser` | Parses inbound HTTP request lines + headers into `RawRequestMessage`. |
| `HttpResponseParser` | `.http_parser` | Parses inbound HTTP response lines + headers into `RawResponseMessage`. |
| `RawRequestMessage` | `.http_parser` | Simple data container for a parsed HTTP request (method, path, version, headers, body). |
| `RawResponseMessage` | `.http_parser` | Simple data container for a parsed HTTP response (status, version, headers, body). |
| **WebSocket** | `.http_websocket` | |
| `WS_CLOSED_MESSAGE`, `WS_CLOSING_MESSAGE` | `.http_websocket` | Pre‑defined `WSMessage` objects representing final WebSocket states. |
| `WS_KEY` | `.http_websocket` | Magic GUID used during WebSocket handshake. |
| `WebSocketReader`, `WebSocketWriter` | `.http_websocket` | Low‑level async I/O helpers for reading/writing WebSocket frames. |
| `ws_ext_gen`, `ws_ext_parse` | `.http_websocket` | Helpers for generating and parsing WebSocket extensions. |
| `WSMessage`, `WSMsgType`, `WSCloseCode` | `.http_websocket` | Data structures that describe WebSocket messages, types, and close codes. |
| `WebSocketError` | `.http_websocket` | Exception hierarchy for WebSocket‑related errors. |

*These symbols are **imported** from the respective sub‑modules and then added to `__all__`; the module itself does not implement any logic for them.*

---

## 3. Dependencies & Relationships

### 3.1 Imports

| Imported name | Source module | Reason for import |
|---------------|---------------|-------------------|
| `sys` | stdlib | Needed for `sys.version_info` while constructing `SERVER_SOFTWARE`. |
| `HTTPStatus` | `http` (stdlib) | Provides the canonical list of HTTP status codes and their textual description for `RESPONSES`. |
| `Mapping`, `Tuple` | `typing` | Type hints for `RESPONSES`. |
| `__version__` | `.` (package root) | aiohttp version string used in `SERVER_SOFTWARE`. |
| `HttpProcessingError` | `.http_exceptions` | Public exception re‑export. |
| `HeadersParser`, `HttpParser`, `HttpRequestParser`, `HttpResponseParser`, `RawRequestMessage`, `RawResponseMessage` | `.http_parser` | Core parsing primitives re‑exported. |
| `WS_*`, `WebSocket*`, `ws_ext_*`, `WSCloseCode`, `WSMsgType`, `WSMessage` | `.http_websocket` | WebSocket support re‑exported. |
| `HttpVersion*`, `StreamWriter` | `.http_writer` | HTTP version identifiers & stream writer re‑exported. |

### 3.2 Interaction with Other Modules

* **Consumes**:
  * `aiohttp.http_exceptions` – provides error classes.
  * `aiohttp.http_parser` – parsing utilities.
  * `aiohttp.http_writer` – serializer utilities.
  * `aiohttp.http_websocket` – WebSocket primitives.
  * `aiohttp.__init__` (via `__version__`) – version metadata.

* **Provides**:
  * A *public namespace* that higher‑level components (e.g., `aiohttp.web`, `aiohttp.client`, user code) import to access low‑level HTTP machinery.
  * Constants (`SERVER_SOFTWARE`, `RESPONSES`) used by the server implementation when building default headers and when generating documentation or error messages.

* **Potential consumers**:
  * `aiohttp.web` – the high‑level web framework builds on parsers, writers, and server software string.
  * `aiohttp.client` – the HTTP client layer utilizes request/response parsers and the stream writer.
  * External user code that needs direct access to parsing or low‑level stream objects.

### 3.3 Architectural Placement

```
aiohttp
 ├─ http.py            ← Facade (this file)
 ├─ http_parser.py    ← Low‑level parsers (implementation)
 ├─ http_writer.py    ← Stream writer and version enums
 ├─ http_websocket.py ← WebSocket helpers
 ├─ http_exceptions.py← Error hierarchy
 └─ web/, client/…     ← Higher‑level APIs that import from http.py
```

*`http.py`* sits at the **edge of the package**, defining the contract that the rest of aiohttp (and its users) rely on while delegating all heavy lifting to the underlying modules.

---

## 4. Workflow Description

1. **Module import is triggered** (e.g., `import aiohttp.http` or any `from aiohttp.http import …`).
2. **Standard library imports** (`sys`, `HTTPStatus`, `typing`) are resolved.
3. **Package internal imports** pull symbols from the sibling modules. These imports execute the sub‑modules if they have not been loaded yet, which in turn define their own public objects.
4. **`SERVER_SOFTWARE` is computed** using the current interpreter version (`sys.version_info`) and the aiohttp version (`__version__`). This is a *module‑level constant* that is ready immediately.
5. **`RESPONSES` is built** via a dictionary‑comprehension iterating over `HTTPStatus.__members__`. Each entry maps a status code to a tuple `(phrase, description)`.
6. **`__all__` tuple is defined** – a static list of names that the module wishes to expose.
7. **Import-time side‑effects complete** – no further runtime logic is executed. The module now serves as a namespace that other code can import from.

*There is no runtime function call flow beyond this initialization; all heavy lifting occurs in the imported sub‑modules.*

---

## 5. Usage Examples

Below are realistic snippets that rely exclusively on the symbols provided by this module.

### 5.1 Getting the default `Server:` header value

```python
from aiohttp.http import SERVER_SOFTWARE

def default_server_header() -> str:
    return f"Server: {SERVER_SOFTWARE}"

print(default_server_header())
# Example output: "Server: Python/3.11 aiohttp/3.9.5"
```

### 5.2 Looking up a human‑readable description for a status code

```python
from aiohttp.http import RESPONSES

def status_info(code: int) -> str:
    phrase, description = RESPONSES.get(code, ("UNKNOWN", ""))
    return f"{code} {phrase}: {description}"

print(status_info(404))
# "404 NOT FOUND: The server can not find the requested resource."
```

### 5.3 Importing low‑level HTTP parser classes

```python
from aiohttp.http import HttpRequestParser, RawRequestMessage

async def parse_request(data: bytes) -> RawRequestMessage:
    parser = HttpRequestParser()
    # Feed the raw bytes incrementally; here we just feed all at once for brevity.
    parser.feed_data(data)
    return parser.get_message()
```

### 5.4 Using the WebSocket utilities

```python
from aiohttp.http import WebSocketReader, WSMessage, WSMsgType

async def consume_ws(reader: WebSocketReader):
    async for msg in reader:
        if isinstance(msg, WSMessage):
            if msg.type == WSMsgType.TEXT:
                print("Received text:", msg.data)
            elif msg.type == WSMsgType.CLOSE:
                print("WebSocket closed")
                break
```

---

## 6. Notes for Developers

| Concern | Detail |
|---------|--------|
| **Circular imports** | Because `http.py` imports many sibling modules, care must be taken not to import `http.py` from within those sub‑modules during their initialization (which would cause a circular import). The aiohttp package already respects this ordering, but adding new imports here should be reviewed. |
| **Version string format** | `SERVER_SOFTWARE` is constructed once at import time. If `aiohttp.__version__` is patched later (e.g., for testing), the constant will **not** reflect the change. Re‑computing manually would be required. |
| **Immutability** | Both `SERVER_SOFTWARE` and `RESPONSES` are intended to be read‑only. They are not enforced as immutable (e.g., `RESPONSES` is a mutable `dict`). Changing them at runtime can affect all code that reads them, so treat them as constants. |
| **Export control** | The `__all__` tuple deliberately lists only the public API. Adding a new symbol that you want to expose must also be added to `__all__`, otherwise `from aiohttp.http import *` will hide it. |
| **Type hints** | The module only provides a few explicit hints (`SERVER_SOFTWARE: str`, `RESPONSES: Mapping[int, Tuple[str, str]]`). Users of static analysis tools will still benefit from the type introspection offered by the re‑exported classes (they have their own annotations in the source modules). |
| **Performance** | The dictionary comprehension for `RESPONSES` runs once per interpreter start‑up. The size is modest (<100 entries) and the overhead is negligible. |
| **Python version compatibility** | The module uses `http.HTTPStatus`, introduced in Python 3.5, and f‑string‑compatible formatting (`format`). It therefore requires Python ≥3.6 (consistent with aiohttp’s supported versions). |
| **Extending the public API** | If new low‑level components (e.g., a new parser or a new WebSocket extension) are added to the package, they should be imported and added to `__all__` here to stay discoverable via `aiohttp.http`. |

--- 

*End of documentation for `aiohttp.http`.*